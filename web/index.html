<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticketera Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
    .btn-modern {
        background: linear-gradient(90deg, #1976d2 0%, #42a5f5 100%);
        color: #fff;
        border: none;
        border-radius: 2rem;
        font-weight: 600;
        box-shadow: 0 2px 12px 0 #1976d233;
        transition: box-shadow 0.2s, background 0.2s, transform 0.2s;
        letter-spacing: 0.5px;
    }
    .btn-modern:hover, .btn-modern:focus {
        background: linear-gradient(90deg, #1565c0 0%, #64b5f6 100%);
        box-shadow: 0 4px 24px 0 #1976d266;
        color: #fff;
        transform: translateY(-2px) scale(1.03);
    }
    body {
        background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
        min-height: 100vh;
    }
    .form-label, .form-control, .form-select {
        transition: box-shadow 0.3s, text-shadow 0.3s, color 0.3s;
    }
    .form-label i {
        transition: color 0.3s;
        color: #495057;
    }
    .form-label:hover i, .form-label:focus i {
        color: #0d6efd;
    }
    .form-label:hover, .form-label:focus {
        text-shadow: 0 2px 8px #0d6efd33, 0 0 2px #0d6efd;
        color: #0d6efd;
    }
    .form-control:focus, .form-control:hover, .form-select:focus, .form-select:hover {
        box-shadow: 0 0 0 0.2rem #0d6efd33, 0 2px 8px #0d6efd33;
        border-color: #0d6efd;
    }
    .card {
        background: #fff;
        border-radius: 1rem;
        box-shadow: 0 4px 24px 0 #0001;
        border: none;
    }
    /* Animación de sombra en label solo cuando el input asociado está enfocado o hover */
    .form-group {
        position: relative;
    }
    .form-group:has(.form-control:focus) .form-label,
    .form-group:has(.form-control:hover) .form-label,
    .form-group:has(.form-select:focus) .form-label,
    .form-group:has(.form-select:hover) .form-label {
        text-shadow: 0 2px 8px #0d6efd33, 0 0 2px #0d6efd;
        color: #0d6efd;
    }
    .form-group:has(.form-control:focus) .form-label i,
    .form-group:has(.form-control:hover) .form-label i,
    .form-group:has(.form-select:focus) .form-label i,
    .form-group:has(.form-select:hover) .form-label i {
        color: #0d6efd;
    }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-xl-7">
        <div class="card p-4 mb-4 mt-2">
          <h1 class="mb-4 text-center">Generar Ticket</h1>
          <form id="ticketForm" enctype="multipart/form-data">
        <!-- Eliminado input de fecha duplicado, solo queda el del grid -->
        <div class="row g-3">
            <div class="col-md-6 form-group d-flex align-items-end">
                <div class="w-100">
                  <label for="color" class="form-label"><i class="bi bi-palette-fill me-2" style="color:#ffb300;"></i>Color de fondo del ticket</label>
                  <select class="form-select" id="color" name="color">
                      <option value="#fff8e1" style="background:#fff8e1;">Amarillo pastel</option>
                      <option value="#e1f5fe" style="background:#e1f5fe;">Celeste pastel</option>
                      <option value="#fce4ec" style="background:#fce4ec;">Rosa pastel</option>
                      <option value="#e8f5e9" style="background:#e8f5e9;">Verde pastel</option>
                      <option value="#f3e5f5" style="background:#f3e5f5;">Lila pastel</option>
                      <option value="#ffe0b2" style="background:#ffe0b2;">Durazno pastel</option>
                      <option value="#dcedc8" style="background:#dcedc8;">Verde lima pastel</option>
                      <option value="#b3e5fc" style="background:#b3e5fc;">Azul cielo pastel</option>
                      <option value="#f8bbd0" style="background:#f8bbd0;">Rosa claro pastel</option>
                      <option value="#fffde7" style="background:#fffde7;">Amarillo claro pastel</option>
                      <option value="#fff" style="background:#fff;">Blanco clásico</option>
                  </select>
                </div>
                <div id="colorPreview" class="ms-3 mb-2" style="width:36px;height:36px;border-radius:8px;border:1px solid #ccc;background:#fff8e1;"></div>
            </div>
            <div class="col-md-6 form-group">
                <label for="template" class="form-label"><i class="bi bi-window-stack me-2" style="color:#42a5f5;"></i>Plantilla</label>
                <select class="form-select" id="template" name="template">
                    <option value="template_vale_por.html">Vale por (predeterminado)</option>
                </select>
            </div>
            <div class="col-md-6 form-group">
                <label for="logo" class="form-label"><i class="bi bi-image-fill me-2" style="color:#43a047;"></i>Logo</label>
                <input class="form-control" type="file" id="logo" name="logo" accept="image/*">
            </div>
            <div class="col-md-6 form-group">
                <label for="header" class="form-label"><i class="bi bi-type-bold me-2" style="color:#8e24aa;"></i>Encabezado</label>
                <input type="text" class="form-control" id="header" name="header" placeholder="Ej: Control">
            </div>
            <div class="col-md-6 form-group">
                <label for="title" class="form-label"><i class="bi bi-card-text me-2" style="color:#3949ab;"></i>Título</label>
                <input type="text" class="form-control" id="title" name="title">
            </div>
            <div class="col-12 form-group">
                <label for="content" class="form-label"><i class="bi bi-chat-left-text-fill me-2" style="color:#00bcd4;"></i>Contenido</label>
                <textarea class="form-control" id="content" name="content" rows="3" placeholder="Descripción del ticket"></textarea>
            </div>
            <div class="col-md-6 form-group">
                <label for="pie" class="form-label"><i class="bi bi-pen-fill me-2" style="color:#ef5350;"></i>Pie</label>
                <input type="text" class="form-control" id="pie" name="pie" placeholder="Ej: Gracias por su compra">
            </div>
            <div class="col-md-6 form-group">
                <label for="filtro" class="form-label"><i class="bi bi-funnel-fill me-2" style="color:#ffb300;"></i>Frase a filtrar en control</label>
                <input type="text" class="form-control" id="filtro" name="filtro" placeholder="Ej: vale por">
            </div>
            <div class="col-md-4 form-group">
                <label for="fecha" class="form-label"><i class="bi bi-calendar2-week-fill me-2" style="color:#00897b;"></i>Fecha (opcional)</label>
                <input type="date" class="form-control" id="fecha" name="fecha">
            </div>
            <div class="col-md-4 form-group">
                <label for="cantidad" class="form-label"><i class="bi bi-collection-fill me-2" style="color:#6d4c41;"></i>Cantidad de tickets web</label>
                <input type="number" class="form-control" id="cantidad" name="cantidad" min="1" value="1">
            </div>
            <div class="col-md-4 form-group">
                <label for="inicial" class="form-label"><i class="bi bi-list-ol me-2" style="color:#c62828;"></i>Número inicial</label>
                <input type="number" class="form-control" id="inicial" name="inicial" min="1" value="1">
            </div>
            <div class="col-12 d-flex justify-content-end mt-3">
                <button type="button" class="btn btn-modern btn-lg px-5 py-2" id="btnWeb">
                    <i class="bi bi-printer-fill me-2" style="color:#fff;"></i> Generar Ticket Web
                </button>
            </div>
        </div>
          </form>
        </div>
      </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Vista previa del color seleccionado
const colorSelect = document.getElementById('color');
const colorPreview = document.getElementById('colorPreview');
if(colorSelect && colorPreview) {
  colorSelect.addEventListener('input', function() {
    colorPreview.style.background = this.value;
  });
}
document.getElementById('ticketForm').onsubmit = async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const res = await fetch('/api/ticket', {
        method: 'POST',
        body: formData
    });
    if (res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ticket.docx';
        document.body.appendChild(a);
        a.click();
        a.remove();
        document.getElementById('result').innerHTML = '<div class="alert alert-success">Ticket generado correctamente.</div>';
    } else {
        document.getElementById('result').innerHTML = '<div class="alert alert-danger">Error al generar el ticket.</div>';
    }
}

document.getElementById('btnWeb').onclick = async function() {
    const form = document.getElementById('ticketForm');
    const formData = new FormData(form);
    const cantidad = parseInt(document.getElementById('cantidad').value) || 1;
    const inicial = parseInt(document.getElementById('inicial').value) || 1;
    const params = new URLSearchParams();
    params.append('header', formData.get('header'));
    params.append('title', formData.get('title'));
    params.append('content', formData.get('content'));
    params.append('pie', formData.get('pie'));
    params.append('cantidad', cantidad);
    params.append('inicial', inicial);
    params.append('template', formData.get('template'));
    params.append('filtro', formData.get('filtro'));
    params.append('fecha', formData.get('fecha'));
    params.append('color', formData.get('color'));
    // No se envía logo para web preview
    window.open('/ticketweb?' + params.toString(), '_blank');
}
</script>
</body>
</html>
