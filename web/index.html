<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticketera Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
    .btn-modern {
        background: linear-gradient(90deg, #1976d2 0%, #42a5f5 100%);
        color: #fff;
        border: none;
        border-radius: 2rem;
        font-weight: 600;
        box-shadow: 0 2px 12px 0 #1976d233;
        transition: box-shadow 0.2s, background 0.2s, transform 0.2s;
        letter-spacing: 0.5px;
    }
    .btn-modern:hover, .btn-modern:focus {
        background: linear-gradient(90deg, #1565c0 0%, #64b5f6 100%);
        box-shadow: 0 4px 24px 0 #1976d266;
        color: #fff;
        transform: translateY(-2px) scale(1.03);
    }
    body {
        background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
        min-height: 100vh;
    }
    .form-label, .form-control, .form-select {
        transition: box-shadow 0.3s, text-shadow 0.3s, color 0.3s;
    }
    .form-label i {
        transition: color 0.3s;
        color: #495057;
    }
    .form-label:hover i, .form-label:focus i {
        color: #0d6efd;
    }
    .form-label:hover, .form-label:focus {
        text-shadow: 0 2px 8px #0d6efd33, 0 0 2px #0d6efd;
        color: #0d6efd;
    }
    .form-control:focus, .form-control:hover, .form-select:focus, .form-select:hover {
        box-shadow: 0 0 0 0.2rem #0d6efd33, 0 2px 8px #0d6efd33;
        border-color: #0d6efd;
    }
    .card {
        background: #fff;
        border-radius: 1rem;
        box-shadow: 0 4px 24px 0 #0001;
        border: none;
    }
    /* Animación de sombra en label solo cuando el input asociado está enfocado o hover */
    .form-group {
        position: relative;
    }
    .form-group:has(.form-control:focus) .form-label,
    .form-group:has(.form-control:hover) .form-label,
    .form-group:has(.form-select:focus) .form-label,
    .form-group:has(.form-select:hover) .form-label {
        text-shadow: 0 2px 8px #0d6efd33, 0 0 2px #0d6efd;
        color: #0d6efd;
    }
    .form-group:has(.form-control:focus) .form-label i,
    .form-group:has(.form-control:hover) .form-label i,
    .form-group:has(.form-select:focus) .form-label i,
    .form-group:has(.form-select:hover) .form-label i {
        color: #0d6efd;
    }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-xl-7">
        <div class="card p-4 mb-4 mt-2">
          <h1 class="mb-4 text-center">Generar Ticket</h1>
          <form id="ticketForm" enctype="multipart/form-data">
        <!-- Eliminado input de fecha duplicado, solo queda el del grid -->
        <div class="row g-3">
            <div class="col-md-6 form-group d-flex align-items-end">
                <div class="w-100">
                  <label for="color" class="form-label"><i class="bi bi-palette-fill me-2" style="color:#ffb300;"></i>Color de fondo del ticket</label>
                  <select class="form-select" id="color" name="color">
                      <option value="#fff8e1" style="background:#fff8e1;">Amarillo pastel</option>
                      <option value="#e1f5fe" style="background:#e1f5fe;">Celeste pastel</option>
                      <option value="#fce4ec" style="background:#fce4ec;">Rosa pastel</option>
                      <option value="#e8f5e9" style="background:#e8f5e9;">Verde pastel</option>
                      <option value="#f3e5f5" style="background:#f3e5f5;">Lila pastel</option>
                      <option value="#ffe0b2" style="background:#ffe0b2;">Durazno pastel</option>
                      <option value="#dcedc8" style="background:#dcedc8;">Verde lima pastel</option>
                      <option value="#b3e5fc" style="background:#b3e5fc;">Azul cielo pastel</option>
                      <option value="#f8bbd0" style="background:#f8bbd0;">Rosa claro pastel</option>
                      <option value="#fffde7" style="background:#fffde7;">Amarillo claro pastel</option>
                      <option value="#fff" style="background:#fff;">Blanco clásico</option>
                  </select>
                </div>
                <div id="colorPreview" class="ms-3 mb-2" style="width:36px;height:36px;border-radius:8px;border:1px solid #ccc;background:#fff8e1;"></div>
            </div>
            <div class="col-md-6 form-group">
                <label for="template" class="form-label"><i class="bi bi-window-stack me-2" style="color:#42a5f5;"></i>Plantilla</label>
                <select class="form-select" id="template" name="template">
                    <option value="template_vale_por.html" selected>Vale por (predeterminado)</option>
                    <option value="template_panel_ancho.html">Panel ancho</option>
                    <option value="template_panel_simple.html">Panel simple</option>
                    <option value="template_panel_control.html">Panel control</option>
                    <option value="template_panel_control_vertical.html">Panel control vertical</option>
                    <option value="template_panel_control_vertical_sin_logo.html">Panel control vertical sin logo</option>
                    <option value="template_panel_control_vertical_logo_grande.html">Panel control vertical logo grande</option>
                    <option value="template_panel_control_vertical_logo_grande_pie.html">Panel control vertical logo grande pie</option>
                    <option value="template_panel_control_vertical_logo_grande_4_fila.html">Panel control vertical logo grande (4 por fila)</option>
                    <option value="template_panel_control_vertical_logo_grande_pie_color.html">Panel control vertical logo grande pie color</option>
                    <option value="template_con_sombra.html">Con sombra</option>
                    <option value="template_control_arriba.html">Control arriba</option>
                    <option value="template_dos_ticket_ongrid.html">Dos tickets en grilla</option>
                    <option value="template_fondo_claro.html">Fondo claro</option>
                    <option value="template_minimalista.html">Minimalista</option>
                    <option value="template_tipo_sticker.html">Tipo sticker</option>
                    <option value="template_tipo_tabla.html">Tipo tabla</option>
                    <option value="template_tipo_tarjeta.html">Tipo tarjeta</option>
                    <option value="template_vertical.html">Vertical</option>
                </select>
            </div>
            <div class="col-md-6 form-group">
                <label for="logo" class="form-label"><i class="bi bi-image-fill me-2" style="color:#43a047;"></i>Logo</label>
                <input class="form-control" type="file" id="logo" name="logo" accept="image/*">
                <div class="mt-2">
                  <img id="logoPreview" src="" alt="Vista previa logo" style="max-width:60px;max-height:60px;display:none;border-radius:8px;border:1px solid #ccc;" />
                </div>
            </div>
            <div class="col-md-6 form-group">
                <label for="header" class="form-label"><i class="bi bi-type-bold me-2" style="color:#8e24aa;"></i>Encabezado</label>
                <input type="text" class="form-control" id="header" name="header" placeholder="Ej: Control">
            </div>
            <div class="col-md-6 form-group">
                <label for="title" class="form-label"><i class="bi bi-card-text me-2" style="color:#3949ab;"></i>Título</label>
                <input type="text" class="form-control" id="title" name="title">
            </div>
            <div class="col-12 form-group">
                <label for="content" class="form-label"><i class="bi bi-chat-left-text-fill me-2" style="color:#00bcd4;"></i>Contenido</label>
                <textarea class="form-control" id="content" name="content" rows="3" placeholder="Descripción del ticket"></textarea>
            </div>
            <div class="col-md-6 form-group">
                <label for="pie" class="form-label"><i class="bi bi-pen-fill me-2" style="color:#ef5350;"></i>Pie</label>
                <input type="text" class="form-control" id="pie" name="pie" placeholder="Ej: Gracias por su compra">
            </div>
            <div class="col-md-6 form-group">
                <label for="filtro" class="form-label"><i class="bi bi-funnel-fill me-2" style="color:#ffb300;"></i>Frase a filtrar en control</label>
                <input type="text" class="form-control" id="filtro" name="filtro" placeholder="Ej: vale por">
            </div>
            <div class="col-md-4 form-group">
                <label for="fecha" class="form-label"><i class="bi bi-calendar2-week-fill me-2" style="color:#00897b;"></i>Fecha (opcional)</label>
                <input type="date" class="form-control" id="fecha" name="fecha">
            </div>
            <div class="col-md-4 form-group">
                <label for="cantidad" class="form-label"><i class="bi bi-collection-fill me-2" style="color:#6d4c41;"></i>Cantidad de tickets web</label>
                <input type="number" class="form-control" id="cantidad" name="cantidad" min="1" value="1">
            </div>
            <div class="col-md-4 form-group">
                <label for="ticketsPorFila" class="form-label"><i class="bi bi-grid-3x3-gap-fill me-2" style="color:#1976d2;"></i>Tickets por fila</label>
                <input type="number" class="form-control" id="ticketsPorFila" name="ticketsPorFila" min="1" max="8" value="4">
            </div>
            <div class="col-md-4 form-group">
                <label for="inicial" class="form-label"><i class="bi bi-list-ol me-2" style="color:#c62828;"></i>Número inicial</label>
                <input type="number" class="form-control" id="inicial" name="inicial" min="1" value="1">
            </div>
            <div class="col-12 d-flex justify-content-end mt-3">
        <!-- Modal de ejemplo de plantilla -->
        <div class="modal fade" id="modalEjemploPlantilla" tabindex="-1" aria-labelledby="modalEjemploPlantillaLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalEjemploPlantillaLabel">Ejemplo de plantilla</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <div id="previewPlantilla" style="background:#fff8e1;padding:24px;border-radius:12px;box-shadow:0 2px 12px #0001;"></div>
              </div>
            </div>
          </div>
        </div>
                <button type="button" class="btn btn-modern btn-lg px-5 py-2" id="btnWeb">
                    <i class="bi bi-printer-fill me-2" style="color:#fff;"></i> Generar Ticket Web
                </button>
            </div>
        </div>
          </form>
        </div>
      </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Vista previa de plantilla en modal
const ejemplosPlantillas = {
  'template_con_sombra.html': `
    <div style='font-family:sans-serif;'>
      <div style='background:#fff8e1;border-radius:8px;box-shadow:0 2px 4px #0002;margin-bottom:12px;padding:16px;max-width:350px;'>
        <div style='font-size:15px;font-weight:bold;color:#222;margin-bottom:6px;'>Control N°123</div>
        <div style='display:flex;align-items:center;gap:12px;'>
          <img src="https://placehold.co/50x50" style="width:50px;height:50px;object-fit:contain;border-radius:8px;" alt="Logo" />
          <div style='flex:1;font-size:15px;font-weight:bold;color:#111;'>Lorem ipsum dolor sit amet</div>
        </div>
        <div style='font-size:11px;color:#555;display:flex;justify-content:space-between;margin-top:8px;'><div>28/07/2025</div><div>Gracias por su compra</div></div>
      </div>
    </div>
  `,
  'template_control_arriba.html': `
    <div style='font-family:Verdana,sans-serif;'>
      <div style='border:2px dashed #666;background:#fff8e1;margin-bottom:10px;max-width:350px;'>
        <div style='padding:8px;background:#ddd;font-weight:bold;'>Control N°123</div>
        <div style='padding:8px;'>
          <div style='display:flex;align-items:center;gap:8px;'>
            <img src="https://placehold.co/45x45" style="width:45px;height:45px;object-fit:contain;border-radius:8px;" alt="Logo" />
            <div style='font-size:12px;font-weight:bold;color:#444;'>N°123</div>
            <div style='flex:1;text-align:center;font-size:18px;font-weight:bold;'>Lorem ipsum dolor sit amet</div>
          </div>
          <div style='display:flex;justify-content:space-between;margin-top:5px;font-size:10px;color:#777;'><div>28/07/2025</div><div>Gracias por su compra</div></div>
        </div>
      </div>
    </div>
  `,
  'template_dos_ticket_ongrid.html': `
    <div style='font-family:Arial,sans-serif;'>
      <div style='display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:10px;background:#fff8e1;'>
        <div style='border:1px solid #ccc;padding:10px;'>
          <div style='font-weight:bold;color:#333;margin-bottom:6px;'>Control N°123</div>
          <div style='font-size:13px;'>Lorem ipsum dolor sit amet</div>
          <div style='font-size:11px;margin-top:5px;'>28/07/2025 · Gracias por su compra</div>
        </div>
        <div style='border:1px solid #ccc;padding:10px;'>
          <div style='font-weight:bold;color:#333;margin-bottom:6px;'>Control N°124</div>
          <div style='font-size:13px;'>Lorem ipsum dolor sit amet</div>
          <div style='font-size:11px;margin-top:5px;'>28/07/2025 · Gracias por su compra</div>
        </div>
      </div>
    </div>
  `,
  'template_fondo_claro.html': `
    <div style='font-family:Segoe UI,sans-serif;'>
      <div style='background:#fff8e1;border-left:5px solid #555;margin-bottom:12px;padding:12px;max-width:350px;'>
        <div style='font-size:15px;color:#333;font-weight:bold;margin-bottom:5px;'>Control N°123</div>
        <div style='text-align:center;font-size:16px;color:#222;margin-bottom:5px;'>Lorem ipsum dolor sit amet</div>
        <div style='display:flex;justify-content:space-between;font-size:11px;color:#666;'><div>28/07/2025</div><div>Gracias por su compra</div></div>
      </div>
    </div>
  `,
  'template_minimalista.html': `
    <div style='font-family:Helvetica,Arial,sans-serif;'>
      <div style='padding:10px;margin-bottom:8px;background:#fff8e1;max-width:350px;'>
        <div style='font-size:13px;font-weight:bold;color:#222;'>Control N°123</div>
        <div style='font-size:14px;color:#000;margin:6px 0;'>Lorem ipsum dolor sit amet</div>
        <div style='font-size:11px;color:#555;display:flex;justify-content:space-between;'><span>28/07/2025</span><span>Gracias por su compra</span></div>
      </div>
    </div>
  `,
  'template_tipo_sticker.html': `
    <div style='font-family:Arial,sans-serif;'>
      <div style='display:inline-block;width:48%;margin:1%;padding:8px;border:2px dashed #666;background:#fff8e1;vertical-align:top;max-width:170px;'>
        <div style='font-size:14px;font-weight:bold;margin-bottom:4px;'>Control N°123</div>
        <div style='text-align:left;font-size:14px;margin-bottom:4px;'>Lorem ipsum dolor sit amet</div>
        <div style='font-size:10px;color:#555;'>28/07/2025</div>
        <div style='font-size:10px;text-align:right;color:#555;'>Gracias por su compra</div>
      </div>
    </div>
  `,
  'template_tipo_tabla.html': `
    <div style='font-family:Tahoma,sans-serif;'>
      <div style='border:3px solid #444;background:#fff8e1;padding:15px;margin-bottom:15px;max-width:350px;'>
        <div style='font-size:16px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='text-align:center;font-size:17px;font-weight:bold;margin-bottom:10px;'>Lorem ipsum dolor sit amet</div>
        <div><span style='font-size:12px;color:#666;'>28/07/2025</span><span style='float:right;font-size:12px;color:#666;'>Gracias por su compra</span></div>
      </div>
    </div>
  `,
  'template_tipo_tarjeta.html': `
    <div style='font-family:Tahoma,sans-serif;'>
      <div style='border:3px solid #444;background:#fff8e1;padding:15px;margin-bottom:15px;max-width:350px;'>
        <div style='font-size:16px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='text-align:center;font-size:17px;font-weight:bold;margin-bottom:10px;'>Lorem ipsum dolor sit amet</div>
        <div><span style='font-size:12px;color:#666;'>28/07/2025</span><span style='float:right;font-size:12px;color:#666;'>Gracias por su compra</span></div>
      </div>
    </div>
  `,
  'template_vertical.html': `
    <div style='font-family:sans-serif;'>
      <div style='border:1px dashed #888;margin:5px;padding:10px;background:#fff8e1;max-width:350px;'>
        <div style='background:#f0f0f0;padding:8px;font-size:14px;font-weight:bold;'>Control N°123</div>
        <div style='padding:8px;font-size:14px;'>
          <div style='display:flex;align-items:center;gap:10px;'>
            <img src="https://placehold.co/40x40" style="width:40px;height:40px;object-fit:contain;border-radius:8px;" alt="Logo" />
            <div style='flex:1;text-align:center;font-size:16px;font-weight:bold;'>Lorem ipsum dolor sit amet</div>
          </div>
          <div style='display:flex;justify-content:space-between;font-size:11px;color:#666;margin-top:5px;'><div>28/07/2025</div><div>Gracias por su compra</div></div>
        </div>
      </div>
    </div>
  `,
  'template_vale_por.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='display:flex;border:1px dashed #bbb;border-radius:8px;overflow:hidden;'>
        <div style='background:#f9f9f9;padding:12px 16px;width:25%;border-right:1px solid #eee;'>
          <div style='font-size:14px;font-weight:bold;color:#222;margin-bottom:6px;'>Control N°123</div>
          <div style='font-size:14px;color:#000;'>Lorem ipsum dolor sit amet</div>
        </div>
        <div style='width:75%;padding:12px 16px;'>
          <div style='font-size:12px;color:#333;margin-bottom:8px;'>Título de ejemplo</div>
          <div style='display:flex;align-items:center;gap:12px;'>
            <div style='display:flex;flex-direction:column;align-items:center;width:60px;'>
              <img src="https://placehold.co/50x50" style="width:50px;height:50px;object-fit:contain;border-radius:6px;" alt="Logo" />
              <div style='font-size:11px;color:#444;font-weight:bold;margin-top:5px;'>N°123</div>
            </div>
            <div style='flex:1;font-size:16px;font-weight:bold;color:#000;text-align:center;'>Vale por 1 completo</div>
          </div>
          <div style='display:flex;justify-content:space-between;align-items:center;margin-top:10px;'>
            <div style='font-size:11px;color:#666;'>28/07/2025</div>
            <div style='font-size:11px;color:#999;text-align:right;'>Gracias por su aporte</div>
          </div>
        </div>
      </div>
    </div>
   `,
  'template_panel_simple.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;'>
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='font-size:16px;font-weight:bold;text-align:center;margin-bottom:8px;'>Lorem ipsum dolor sit amet</div>
        <div style='font-size:11px;color:#666;display:flex;justify-content:space-between;'><div>28/07/2025</div><div>Gracias por su aporte</div></div>
      </div>
    </div>
  `,
  'template_panel_ancho.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='display:flex;border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;'>
        <div style='width:30%;padding:10px;border-right:1px solid #ccc;font-size:14px;font-weight:bold;background:#efefef;'>Control N°123</div>
        <div style='flex:1;padding:10px;font-size:14px;'>
          <div style='margin-bottom:8px;font-weight:bold;text-align:center;'>Lorem ipsum dolor sit amet</div>
          <div style='font-size:11px;color:#666;display:flex;justify-content:space-between;'><div>28/07/2025</div><div>Gracias por su aporte</div></div>
        </div>
      </div>
    </div>
   `,
  'template_panel_simple_logo.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;display:flex;align-items:center;'>
        <img src="https://placehold.co/60x60" style="width:60px;height:60px;object-fit:contain;border-radius:8px;margin-right:18px;" alt="Logo" />
        <div style='flex:1;'>
          <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
          <div style='font-size:16px;font-weight:bold;text-align:center;margin-bottom:8px;'>Lorem ipsum dolor sit amet</div>
          <div style='font-size:11px;color:#666;display:flex;justify-content:space-between;'><div>28/07/2025</div><div>Gracias por su aporte</div></div>
        </div>
      </div>
    </div>
  `
  ,
  'template_panel_ancho_logo.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='display:flex;border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;'>
        <div style='width:30%;padding:10px;border-right:1px solid #ccc;font-size:14px;font-weight:bold;background:#efefef;display:flex;flex-direction:column;align-items:center;'>
          <img src="https://placehold.co/60x60" style="width:60px;height:60px;object-fit:contain;border-radius:8px;margin-bottom:8px;" alt="Logo" />
          <span>Control N°123</span>
        </div>
        <div style='flex:1;padding:10px;font-size:14px;'>
          <div style='margin-bottom:8px;font-weight:bold;text-align:center;'>Lorem ipsum dolor sit amet</div>
          <div style='font-size:11px;color:#666;display:flex;justify-content:space-between;'><div>28/07/2025</div><div>Gracias por su aporte</div></div>
        </div>
      </div>
    </div>
  `,
  'template_panel_control.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;'>
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='font-size:14px;text-align:left;margin-bottom:8px;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
        <div style='font-size:11px;color:#666;text-align:right;'>28/07/2025</div>
      </div>
    </div>
  `
  ,
  'template_panel_control_logo.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;display:flex;align-items:center;'>
        <img src="https://placehold.co/60x60" style="width:60px;height:60px;object-fit:contain;border-radius:8px;margin-right:18px;" alt="Logo" />
        <div style='flex:1;'>
          <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
          <div style='font-size:14px;text-align:left;margin-bottom:8px;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
          <div style='font-size:11px;color:#666;text-align:right;'>28/07/2025</div>
        </div>
      </div>
    </div>
  `
  ,
  'template_panel_control_vertical.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;display:flex;flex-direction:column;align-items:center;'>
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='font-size:14px;text-align:center;margin-bottom:8px;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
        <img src="https://placehold.co/60x60" style="width:60px;height:60px;object-fit:contain;border-radius:8px;margin-bottom:8px;" alt="Logo" />
        <div style='font-size:11px;color:#666;text-align:right;width:100%;'>28/07/2025</div>
      </div>
    </div>
  `
  ,
  'template_panel_control_vertical_sin_logo.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;display:flex;flex-direction:column;align-items:center;'>
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='font-size:14px;text-align:center;margin-bottom:8px;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
        <div style='font-size:11px;color:#666;text-align:right;width:100%;'>28/07/2025</div>
      </div>
    </div>
  `
  ,
  'template_panel_control_vertical_logo_grande.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;display:flex;flex-direction:column;align-items:center;'>
        <img src="https://placehold.co/100x100" style="width:100px;height:100px;object-fit:contain;border-radius:12px;margin-bottom:12px;" alt="Logo grande" />
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='font-size:14px;text-align:center;margin-bottom:8px;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
        <div style='font-size:11px;color:#666;text-align:right;width:100%;'>28/07/2025</div>
      </div>
    </div>
  `
  ,
  'template_panel_control_vertical_logo_grande_pie.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:#fff8e1;margin-bottom:10px;padding:18px 24px;display:flex;flex-direction:column;align-items:center;'>
        <img src="https://placehold.co/100x100" style="width:100px;height:100px;object-fit:contain;border-radius:12px;margin-bottom:12px;" alt="Logo grande" />
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;'>Control N°123</div>
        <div style='font-size:14px;text-align:center;margin-bottom:8px;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
        <div style='font-size:11px;color:#666;text-align:right;width:100%;'>28/07/2025</div>
        <div style='font-size:12px;color:#999;text-align:center;width:100%;margin-top:10px;'>Gracias por su compra</div>
      </div>
    </div>
  `
  ,
  'template_panel_control_vertical_logo_grande_pie_color.html': `
    <div style='font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;'>
      <div style='border:1px dashed #bbb;background:linear-gradient(135deg,#fff8e1 60%,#ffe0b2 100%);margin-bottom:10px;padding:18px 24px;display:flex;flex-direction:column;align-items:center;'>
        <img src="https://placehold.co/100x100" style="width:100px;height:100px;object-fit:contain;border-radius:12px;margin-bottom:12px;" alt="Logo grande" />
        <div style='font-size:15px;font-weight:bold;margin-bottom:8px;color:#ff9800;'>Control N°123</div>
        <div style='font-size:14px;text-align:center;margin-bottom:8px;color:#6d4c41;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.</div>
        <div style='font-size:11px;color:#666;text-align:right;width:100%;'>28/07/2025</div>
        <div style='font-size:12px;color:#ff9800;text-align:center;width:100%;margin-top:10px;'>Gracias por su compra</div>
      </div>
    </div>
  `
};

document.getElementById('template').addEventListener('change', function() {
  const val = this.value;
  if (ejemplosPlantillas[val]) {
    document.getElementById('previewPlantilla').innerHTML = ejemplosPlantillas[val];
    const modal = new bootstrap.Modal(document.getElementById('modalEjemploPlantilla'));
    modal.show();
  }
});
</script>
<script>
// Validar tamaño y dimensiones del logo antes de enviar y subirlo vía AJAX
document.getElementById('logo').addEventListener('change', function(e) {
  const file = this.files[0];
  if (!file) return;
  if (file.size > 1024 * 1024) {
    alert('El logo no debe superar los 1MB.');
    this.value = '';
    return;
  }
  const img = new Image();
  img.onload = () => {
    if (img.width > 1900 || img.height > 1900) {
      alert('El logo no debe superar 1900x1900 píxeles.');
      document.getElementById('logo').value = '';
      return;
    }
    // Subir el logo al backend
    const formData = new FormData();
    formData.append('logo', file);
    fetch('/api/logo', {
      method: 'POST',
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if (data.url) {
        // Guardar la URL en un input oculto para usarla en el ticket
        let input = document.getElementById('logo_url');
        if (!input) {
          input = document.createElement('input');
          input.type = 'hidden';
          input.id = 'logo_url';
          input.name = 'logo_url';
          document.getElementById('ticketForm').appendChild(input);
        }
        input.value = data.url;
        // Vista previa del logo
        const logoPreview = document.getElementById('logoPreview');
        if (logoPreview) {
          logoPreview.src = data.url;
          logoPreview.style.display = 'block';
        }
      } else {
        alert('Error al guardar el logo.');
        document.getElementById('logo').value = '';
      }
    })
    .catch(() => {
      alert('Error al subir el logo.');
      document.getElementById('logo').value = '';
    });
  };
  img.onerror = () => {
    alert('Archivo de imagen no válido.');
    document.getElementById('logo').value = '';
  };
  img.src = URL.createObjectURL(file);
});
// Vista previa del color seleccionado
const colorSelect = document.getElementById('color');
const colorPreview = document.getElementById('colorPreview');
if(colorSelect && colorPreview) {
  colorSelect.addEventListener('input', function() {
    colorPreview.style.background = this.value;
  });
}
document.getElementById('ticketForm').onsubmit = async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const res = await fetch('/api/ticket', {
        method: 'POST',
        body: formData
    });
    if (res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ticket.docx';
        document.body.appendChild(a);
        a.click();
        a.remove();
        document.getElementById('result').innerHTML = '<div class="alert alert-success">Ticket generado correctamente.</div>';
    } else {
        document.getElementById('result').innerHTML = '<div class="alert alert-danger">Error al generar el ticket.</div>';
    }
}

document.getElementById('btnWeb').onclick = async function() {
    const form = document.getElementById('ticketForm');
    const formData = new FormData(form);
    const cantidad = parseInt(document.getElementById('cantidad').value) || 1;
    const inicial = parseInt(document.getElementById('inicial').value) || 1;
    const params = new URLSearchParams();
    params.append('header', formData.get('header'));
    params.append('title', formData.get('title'));
    params.append('content', formData.get('content'));
    params.append('pie', formData.get('pie'));
    params.append('cantidad', cantidad);
    params.append('inicial', inicial);
    params.append('template', formData.get('template'));
    params.append('filtro', formData.get('filtro'));
    params.append('fecha', formData.get('fecha'));
    params.append('color', formData.get('color'));
    // No se envía logo para web preview
    params.append('ticketsPorFila', formData.get('ticketsPorFila'));
    window.open('/ticketweb?' + params.toString(), '_blank');
}
</script>
</body>
</html>
